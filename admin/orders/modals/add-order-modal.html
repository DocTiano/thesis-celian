<!-- Add Order Modal -->
<div class="modal fade" id="addOrderModal" tabindex="-1" aria-labelledby="addOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addOrderModalLabel">
                    <i class="bi bi-plus-circle text-primary me-2"></i>
                    Add New Order
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addOrderForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="customerName" class="form-label">Customer Name *</label>
                                <input type="text" class="form-control" id="customerName" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="customerPhone" class="form-label">Phone Number *</label>
                                <input type="tel" class="form-control" id="customerPhone" required>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="customerEmail" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="customerEmail">
                    </div>
                    <div class="mb-3">
                        <label for="deliveryAddress" class="form-label">Delivery Address *</label>
                        <textarea class="form-control" id="deliveryAddress" rows="3" required></textarea>
                    </div>
                    
                    <h6 class="mb-3">Order Items</h6>
                    <div id="orderItems">
                        <div class="order-item mb-3 p-3 border rounded">
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Product *</label>
                                    <select class="form-control" name="product" required>
                                        <option value="">Select Product</option>
                                        <option value="rice-5kg">Sagnay Rice (5kg) - ₱350</option>
                                        <option value="woven-basket">Woven Basket - ₱450</option>
                                        <option value="fresh-fish">Fresh Fish - ₱120</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Quantity *</label>
                                    <input type="number" class="form-control" name="quantity" min="1" value="1" required>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Price</label>
                                    <input type="text" class="form-control" name="price" readonly>
                                </div>
                                <div class="col-md-1">
                                    <label class="form-label">&nbsp;</label>
                                    <button type="button" class="btn btn-outline-danger btn-sm d-block" onclick="removeOrderItem(this)">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-outline-primary btn-sm mb-3" onclick="addOrderItem()">
                        <i class="bi bi-plus"></i> Add Another Item
                    </button>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="paymentMethod" class="form-label">Payment Method *</label>
                                <select class="form-control" id="paymentMethod" required>
                                    <option value="">Select Payment Method</option>
                                    <option value="cod">Cash on Delivery</option>
                                    <option value="gcash">GCash</option>
                                    <option value="bank-transfer">Bank Transfer</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="deliveryMethod" class="form-label">Delivery Method *</label>
                                <select class="form-control" id="deliveryMethod" required>
                                    <option value="">Select Delivery Method</option>
                                    <option value="standard">Standard Delivery</option>
                                    <option value="express">Express Delivery</option>
                                    <option value="pickup">Store Pickup</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="orderNotes" class="form-label">Order Notes</label>
                        <textarea class="form-control" id="orderNotes" rows="2" placeholder="Special instructions or notes..."></textarea>
                    </div>
                    
                    <div class="border-top pt-3">
                        <div class="row">
                            <div class="col-md-8">
                                <strong>Total Amount: </strong>
                            </div>
                            <div class="col-md-4 text-end">
                                <strong id="totalAmount">₱0.00</strong>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitAddOrder()">
                    <i class="bi bi-check-circle me-1"></i>
                    Create Order
                </button>
            </div>
        </div>
    </div>
</div>

<script>
const productPrices = {
    'rice-5kg': 350,
    'woven-basket': 450,
    'fresh-fish': 120
};

function addOrderItem() {
    const itemsContainer = document.getElementById('orderItems');
    const newItem = document.querySelector('.order-item').cloneNode(true);
    
    // Clear values
    newItem.querySelectorAll('select, input').forEach(input => {
        if (input.type !== 'number') {
            input.value = '';
        } else if (input.name === 'quantity') {
            input.value = 1;
        }
    });
    
    itemsContainer.appendChild(newItem);
    updateTotal();
}

function removeOrderItem(button) {
    const items = document.querySelectorAll('.order-item');
    if (items.length > 1) {
        button.closest('.order-item').remove();
        updateTotal();
    }
}

function updateTotal() {
    let total = 0;
    document.querySelectorAll('.order-item').forEach(item => {
        const productSelect = item.querySelector('select[name="product"]');
        const quantityInput = item.querySelector('input[name="quantity"]');
        const priceInput = item.querySelector('input[name="price"]');
        
        const productId = productSelect.value;
        const quantity = parseInt(quantityInput.value) || 0;
        
        if (productId && productPrices[productId]) {
            const price = productPrices[productId];
            const itemTotal = price * quantity;
            priceInput.value = `₱${itemTotal.toFixed(2)}`;
            total += itemTotal;
        } else {
            priceInput.value = '';
        }
    });
    
    document.getElementById('totalAmount').textContent = `₱${total.toFixed(2)}`;
}

// Add event listeners to update total when products/quantities change
document.addEventListener('change', function(e) {
    if (e.target.name === 'product' || e.target.name === 'quantity') {
        updateTotal();
    }
});

function submitAddOrder() {
    const form = document.getElementById('addOrderForm');
    if (form.checkValidity()) {
        // Collect order data
        const orderData = {
            customer: {
                name: document.getElementById('customerName').value,
                phone: document.getElementById('customerPhone').value,
                email: document.getElementById('customerEmail').value
            },
            delivery: {
                address: document.getElementById('deliveryAddress').value,
                method: document.getElementById('deliveryMethod').value
            },
            payment: {
                method: document.getElementById('paymentMethod').value
            },
            items: [],
            notes: document.getElementById('orderNotes').value
        };
        
        // Collect items
        document.querySelectorAll('.order-item').forEach(item => {
            const product = item.querySelector('select[name="product"]').value;
            const quantity = item.querySelector('input[name="quantity"]').value;
            if (product && quantity) {
                orderData.items.push({ product, quantity: parseInt(quantity) });
            }
        });
        
        if (orderData.items.length === 0) {
            alert('Please add at least one item to the order.');
            return;
        }
        
        // Simulate API call
        console.log('Creating order:', orderData);
        
        // Show success message
        alert('Order created successfully!');
        
        // Close modal and reset form
        const modal = bootstrap.Modal.getInstance(document.getElementById('addOrderModal'));
        modal.hide();
        form.reset();
        
        // Refresh table
        location.reload();
    } else {
        form.reportValidity();
    }
}
</script>
