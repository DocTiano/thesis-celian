<!-- Add New User Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addUserModalLabel">
                    <i class="bi bi-plus-circle text-primary me-2"></i>
                    Add New User
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="firstName" class="form-label">First Name *</label>
                                <input type="text" class="form-control" id="firstName" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="lastName" class="form-label">Last Name *</label>
                                <input type="text" class="form-control" id="lastName" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="userEmail" class="form-label">Email Address *</label>
                                <input type="email" class="form-control" id="userEmail" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="userPhone" class="form-label">Phone Number *</label>
                                <input type="tel" class="form-control" id="userPhone" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="userRole" class="form-label">User Role *</label>
                                <select class="form-control" id="userRole" required>
                                    <option value="">Select Role</option>
                                    <option value="customer">Customer</option>
                                    <option value="producer">Producer</option>
                                    <option value="admin">Admin</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="userStatus" class="form-label">Account Status</label>
                                <select class="form-control" id="userStatus">
                                    <option value="active">Active</option>
                                    <option value="pending">Pending Verification</option>
                                    <option value="suspended">Suspended</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="userAddress" class="form-label">Address</label>
                        <textarea class="form-control" id="userAddress" rows="3"></textarea>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="userPassword" class="form-label">Password *</label>
                                <input type="password" class="form-control" id="userPassword" required>
                                <small class="text-muted">Minimum 8 characters</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="confirmPassword" class="form-label">Confirm Password *</label>
                                <input type="password" class="form-control" id="confirmPassword" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3" id="producerFields" style="display: none;">
                        <h6>Producer Information</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="businessName" class="form-label">Business Name</label>
                                    <input type="text" class="form-control" id="businessName">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="businessType" class="form-label">Business Type</label>
                                    <select class="form-control" id="businessType">
                                        <option value="">Select Type</option>
                                        <option value="individual">Individual</option>
                                        <option value="cooperative">Cooperative</option>
                                        <option value="association">Association</option>
                                        <option value="corporation">Corporation</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="businessDescription" class="form-label">Business Description</label>
                            <textarea class="form-control" id="businessDescription" rows="3"></textarea>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="sendWelcomeEmail" checked>
                            <label class="form-check-label" for="sendWelcomeEmail">
                                Send welcome email to user
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="requireEmailVerification" checked>
                            <label class="form-check-label" for="requireEmailVerification">
                                Require email verification
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitAddUser()">
                    <i class="bi bi-check-circle me-1"></i>
                    Create User
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Show/hide producer fields based on role selection
document.getElementById('userRole').addEventListener('change', function() {
    const producerFields = document.getElementById('producerFields');
    if (this.value === 'producer') {
        producerFields.style.display = 'block';
    } else {
        producerFields.style.display = 'none';
    }
});

function submitAddUser() {
    const form = document.getElementById('addUserForm');
    if (form.checkValidity()) {
        // Check password confirmation
        const password = document.getElementById('userPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        if (password !== confirmPassword) {
            alert('Passwords do not match.');
            return;
        }
        
        // Collect user data
        const userData = {
            firstName: document.getElementById('firstName').value,
            lastName: document.getElementById('lastName').value,
            email: document.getElementById('userEmail').value,
            phone: document.getElementById('userPhone').value,
            role: document.getElementById('userRole').value,
            status: document.getElementById('userStatus').value,
            address: document.getElementById('userAddress').value,
            password: password,
            sendWelcomeEmail: document.getElementById('sendWelcomeEmail').checked,
            requireEmailVerification: document.getElementById('requireEmailVerification').checked
        };
        
        // Add producer fields if applicable
        if (userData.role === 'producer') {
            userData.business = {
                name: document.getElementById('businessName').value,
                type: document.getElementById('businessType').value,
                description: document.getElementById('businessDescription').value
            };
        }
        
        // Simulate API call
        console.log('Creating user:', userData);
        
        // Show success message
        alert('User created successfully!');
        
        // Close modal and reset form
        const modal = bootstrap.Modal.getInstance(document.getElementById('addUserModal'));
        modal.hide();
        form.reset();
        
        // Refresh table
        location.reload();
    } else {
        form.reportValidity();
    }
}
</script>
