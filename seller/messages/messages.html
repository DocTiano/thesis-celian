<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messages | Seller Dashboard</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Seller Styles -->
    <link href="../assets/css/seller-styles.css" rel="stylesheet">
    
    <script>
        // Load message modals
        async function loadMessageModals() {
            const modalFiles = [
                'modals/customer-details-modal.html',
                'modals/order-quick-look-modal.html', 
                'modals/quick-templates-modal.html'
            ];
            
            for (const file of modalFiles) {
                try {
                    const response = await fetch(file);
                    if (response.ok) {
                        const html = await response.text();
                        document.body.insertAdjacentHTML('beforeend', html);
                    }
                } catch (error) {
                    console.log(`Could not load ${file}:`, error);
                }
            }
        }
        
        // Load modals on page load
        loadMessageModals();
    </script>
    
    <style>
        .messages-layout {
            display: flex;
            height: calc(100vh - 120px);
            gap: 1rem;
        }
        
        .messages-sidebar {
            width: 320px;
            min-width: 320px;
            background: white;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }
        
        .messages-main {
            flex: 1;
            background: white;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }
        
        .conversation-list {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }
        
        .conversation-item {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .conversation-item:hover {
            background-color: #f8f9fa;
        }
        
        .conversation-item.active {
            background-color: #e3f2fd;
            border-right: 3px solid #1976d2;
        }
        
        .conversation-item .unread-badge {
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chat-header {
            padding: 1rem;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: between;
            gap: 1rem;
        }
        
        .chat-body {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: #f8f9fa;
        }
        
        .chat-footer {
            padding: 1rem;
            border-top: 1px solid #e0e0e0;
        }
        
        .message-bubble {
            max-width: 70%;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            position: relative;
        }
        
        .message-bubble.received {
            background: white;
            border: 1px solid #e0e0e0;
            margin-right: auto;
        }
        
        .message-bubble.sent {
            background: #1976d2;
            color: white;
            margin-left: auto;
        }
        
        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.25rem;
        }
        
        .message-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: flex-end;
        }
        
        .message-input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 0.75rem 1rem;
            resize: none;
            max-height: 100px;
        }
        
        .empty-chat {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
        }
        
        .conversation-search {
            padding: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .conversation-tabs {
            padding: 0 1rem;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .conversation-tabs .nav-link {
            color: #666;
            border: none;
            border-bottom: 2px solid transparent;
            padding: 0.75rem 0.5rem;
            font-size: 0.9rem;
        }
        
        .conversation-tabs .nav-link.active {
            color: #1976d2;
            border-bottom-color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="seller-layout">
        <!-- Sidebar -->
        <nav class="seller-sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">S2EH</div>
                <div class="title">SELLER PORTAL</div>
            </div>
            <div class="sidebar-nav">
                <div class="nav-item">
                    <a href="../dashboard/dashboard.html" class="nav-link">
                        <i class="bi bi-speedometer2"></i>
                        <span>Dashboard</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="../products/products.html" class="nav-link">
                        <i class="bi bi-box"></i>
                        <span>My Products</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="../orders/orders.html" class="nav-link">
                        <i class="bi bi-cart3"></i>
                        <span>Orders</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="../inventory/inventory.html" class="nav-link">
                        <i class="bi bi-boxes"></i>
                        <span>Inventory</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="../customers/customers.html" class="nav-link">
                        <i class="bi bi-people"></i>
                        <span>Customers</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="messages.html" class="nav-link active">
                        <i class="bi bi-chat-dots"></i>
                        <span>Messages</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="../analytics/analytics.html" class="nav-link">
                        <i class="bi bi-graph-up"></i>
                        <span>Analytics</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="../profile/profile.html" class="nav-link">
                        <i class="bi bi-person-circle"></i>
                        <span>My Profile</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="../settings/settings.html" class="nav-link">
                        <i class="bi bi-gear"></i>
                        <span>Settings</span>
                    </a>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="seller-main">
            <!-- Top Bar -->
            <header class="seller-topbar">
                <div class="topbar-left">
                    <button class="sidebar-toggle" id="sidebarToggle">
                        <i class="bi bi-list"></i>
                    </button>
                    <h1 class="page-title">Messages</h1>
                </div>
                <div class="topbar-right">
                    <button class="notification-icon" title="Notifications">
                        <i class="bi bi-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>
                    <div class="seller-profile">
                        <div class="seller-avatar">JD</div>
                        <span>Juan Santos</span>
                        <i class="bi bi-chevron-down"></i>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="seller-content">
                <!-- Messages Layout -->
                <div class="messages-layout">
                    <!-- Messages Sidebar -->
                    <div class="messages-sidebar">
                        <!-- Search -->
                        <div class="conversation-search">
                            <div class="input-group">
                                <span class="input-group-text bg-transparent border-end-0">
                                    <i class="bi bi-search"></i>
                                </span>
                                <input type="text" class="form-control border-start-0" placeholder="Search conversations...">
                            </div>
                        </div>
                        
                        <!-- Tabs -->
                        <div class="conversation-tabs">
                            <ul class="nav nav-tabs nav-fill">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#" data-filter="all">All (8)</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-filter="unread">Unread (3)</a>
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Conversation List -->
                        <div class="conversation-list" id="conversationList">
                            <div class="conversation-item active" data-conversation="maria">
                                <div class="customer-avatar">MR</div>
                                <div class="flex-grow-1">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <h6 class="mb-0">Maria Rodriguez</h6>
                                        <small class="text-muted">2m ago</small>
                                    </div>
                                    <p class="mb-0 text-muted small">Thank you for the quick delivery!</p>
                                </div>
                                <div class="unread-badge">2</div>
                            </div>
                            
                            <div class="conversation-item" data-conversation="jose">
                                <div class="customer-avatar">JS</div>
                                <div class="flex-grow-1">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <h6 class="mb-0">Jose Silva</h6>
                                        <small class="text-muted">1h ago</small>
                                    </div>
                                    <p class="mb-0 text-muted small">When will my order be processed?</p>
                                </div>
                                <div class="unread-badge">1</div>
                            </div>
                            
                            <div class="conversation-item" data-conversation="ana">
                                <div class="customer-avatar">AL</div>
                                <div class="flex-grow-1">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <h6 class="mb-0">Ana Lopez</h6>
                                        <small class="text-muted">3h ago</small>
                                    </div>
                                    <p class="mb-0 text-muted small">Great products! Will order again.</p>
                                </div>
                            </div>
                            
                            <div class="conversation-item" data-conversation="carlos">
                                <div class="customer-avatar">CG</div>
                                <div class="flex-grow-1">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <h6 class="mb-0">Carlos Garcia</h6>
                                        <small class="text-muted">1d ago</small>
                                    </div>
                                    <p class="mb-0 text-muted small">Do you have organic vegetables?</p>
                                </div>
                            </div>
                            
                            <div class="conversation-item" data-conversation="lisa">
                                <div class="customer-avatar">LM</div>
                                <div class="flex-grow-1">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <h6 class="mb-0">Lisa Martinez</h6>
                                        <small class="text-muted">2d ago</small>
                                    </div>
                                    <p class="mb-0 text-muted small">Can I get a discount for bulk orders?</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat Area -->
                    <div class="messages-main" id="chatArea">
                        <!-- Chat Header -->
                        <div class="chat-header">
                            <div class="d-flex align-items-center flex-grow-1">
                                <div class="customer-avatar me-3">MR</div>
                                <div>
                                    <h6 class="mb-0">Maria Rodriguez</h6>
                                    <small class="text-success">
                                        <i class="bi bi-circle-fill" style="font-size: 0.5rem;"></i>
                                        Online
                                    </small>
                                </div>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#customerDetailsModal">
                                    <i class="bi bi-person"></i>
                                    Details
                                </button>
                                <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#orderQuickLookModal">
                                    <i class="bi bi-cart"></i>
                                    Orders
                                </button>
                            </div>
                        </div>
                        
                        <!-- Chat Body -->
                        <div class="chat-body" id="chatMessages">
                            <div class="message-bubble received">
                                <div class="message-content">
                                    Hi! I just received my order and everything looks great. Thank you!
                                </div>
                                <div class="message-time">Today 2:30 PM</div>
                            </div>
                            
                            <div class="message-bubble sent">
                                <div class="message-content">
                                    That's wonderful to hear! Thank you for choosing our products. We really appreciate your feedback.
                                </div>
                                <div class="message-time">Today 2:32 PM</div>
                            </div>
                            
                            <div class="message-bubble received">
                                <div class="message-content">
                                    The rice quality is excellent! I'll definitely be ordering more soon. Do you have any promotions coming up?
                                </div>
                                <div class="message-time">Today 2:35 PM</div>
                            </div>
                            
                            <div class="message-bubble sent">
                                <div class="message-content">
                                    Thank you so much! Yes, we're actually having a 15% discount on all rice products next week. I'll send you the details via email.
                                </div>
                                <div class="message-time">Today 2:37 PM</div>
                            </div>
                            
                            <div class="message-bubble received">
                                <div class="message-content">
                                    Perfect! Thank you for the excellent service. 😊
                                </div>
                                <div class="message-time">Today 2:38 PM</div>
                            </div>
                        </div>
                        
                        <!-- Chat Footer -->
                        <div class="chat-footer">
                            <div class="message-input-group">
                                <button class="btn btn-outline-secondary" title="Attach File">
                                    <i class="bi bi-paperclip"></i>
                                </button>
                                <button class="btn btn-outline-secondary" title="Quick Templates" data-bs-toggle="modal" data-bs-target="#quickTemplatesModal">
                                    <i class="bi bi-lightning"></i>
                                </button>
                                <textarea class="message-input" placeholder="Type your message..." rows="1"></textarea>
                                <button class="btn-seller" onclick="sendMessage()">
                                    <i class="bi bi-send"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Message Modals Container -->
    <div id="messageModals"></div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Conversation item click
            $('.conversation-item').click(function() {
                $('.conversation-item').removeClass('active');
                $(this).addClass('active');
                
                // Remove unread badge
                $(this).find('.unread-badge').remove();
                
                // Load conversation (in real app, this would load from server)
                const conversationId = $(this).data('conversation');
                loadConversation(conversationId);
            });

            // Auto-resize textarea
            $('.message-input').on('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            // Send message on Enter (but allow Shift+Enter for new lines)
            $('.message-input').keydown(function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Filter conversations
            $('.conversation-tabs .nav-link').click(function(e) {
                e.preventDefault();
                $('.conversation-tabs .nav-link').removeClass('active');
                $(this).addClass('active');
                
                const filter = $(this).data('filter');
                filterConversations(filter);
            });

            // Load message modals
            loadMessageModals();
        });

        function loadConversation(conversationId) {
            // In a real app, this would fetch conversation data from server
            console.log('Loading conversation:', conversationId);
            
            // Update chat header based on conversation
            const conversations = {
                'maria': { name: 'Maria Rodriguez', avatar: 'MR', status: 'Online' },
                'jose': { name: 'Jose Silva', avatar: 'JS', status: 'Away' },
                'ana': { name: 'Ana Lopez', avatar: 'AL', status: 'Offline' },
                'carlos': { name: 'Carlos Garcia', avatar: 'CG', status: 'Offline' },
                'lisa': { name: 'Lisa Martinez', avatar: 'LM', status: 'Online' }
            };
            
            const conversation = conversations[conversationId];
            if (conversation) {
                $('.chat-header .customer-avatar').text(conversation.avatar);
                $('.chat-header h6').text(conversation.name);
                
                const statusClass = conversation.status === 'Online' ? 'text-success' : 
                                  conversation.status === 'Away' ? 'text-warning' : 'text-muted';
                $('.chat-header small').removeClass('text-success text-warning text-muted')
                                      .addClass(statusClass)
                                      .html(`<i class="bi bi-circle-fill" style="font-size: 0.5rem;"></i> ${conversation.status}`);
            }
        }

        function sendMessage() {
            const messageInput = $('.message-input');
            const messageText = messageInput.val().trim();
            
            if (messageText) {
                const now = new Date();
                const timeStr = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                const messageHtml = `
                    <div class="message-bubble sent">
                        <div class="message-content">${messageText}</div>
                        <div class="message-time">Today ${timeStr}</div>
                    </div>
                `;
                
                $('#chatMessages').append(messageHtml);
                messageInput.val('').css('height', 'auto');
                
                // Scroll to bottom
                const chatBody = document.getElementById('chatMessages');
                chatBody.scrollTop = chatBody.scrollHeight;
                
                // In a real app, send message to server here
            }
        }

        function filterConversations(filter) {
            if (filter === 'all') {
                $('.conversation-item').show();
            } else if (filter === 'unread') {
                $('.conversation-item').hide();
                $('.conversation-item').has('.unread-badge').show();
            }
        }

        // Load message modals
        async function loadMessageModals() {
            const modalFiles = [
                'modals/customer-details-modal.html',
                'modals/order-quick-look-modal.html',
                'modals/quick-templates-modal.html'
            ];
            
            for (const file of modalFiles) {
                try {
                    const response = await fetch(file);
                    if (response.ok) {
                        const html = await response.text();
                        document.getElementById('messageModals').innerHTML += html;
                    }
                } catch (error) {
                    console.log(`Could not load ${file}:`, error);
                }
            }
        }
    </script>
    
    <!-- Seller Main JS -->
    <script src="../assets/js/seller-main.js"></script>
</body>
</html>
