<!-- Change Password Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changePasswordModalLabel">
                    <i class="bi bi-shield-lock me-2"></i>Change Password
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm">
                    <div class="mb-3">
                        <label for="currentPassword" class="form-label">Current Password *</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="currentPassword" required>
                            <button class="btn btn-outline-secondary" type="button" id="toggleCurrentPassword">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="newPassword" class="form-label">New Password *</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="newPassword" required>
                            <button class="btn btn-outline-secondary" type="button" id="toggleNewPassword">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                        <div class="form-text">Password must be at least 8 characters long</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="confirmPassword" class="form-label">Confirm New Password *</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="confirmPassword" required>
                            <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Password Strength Indicator -->
                    <div class="password-strength mb-3" id="passwordStrength" style="display: none;">
                        <div class="strength-label">Password Strength:</div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar" id="strengthBar"></div>
                        </div>
                        <div class="strength-text" id="strengthText"></div>
                    </div>
                    
                    <!-- Password Requirements -->
                    <div class="password-requirements mb-3">
                        <small class="text-muted">Password requirements:</small>
                        <div class="requirements-list">
                            <div class="requirement" id="req-length">
                                <i class="bi bi-x-circle text-danger"></i>
                                <span>At least 8 characters</span>
                            </div>
                            <div class="requirement" id="req-lowercase">
                                <i class="bi bi-x-circle text-danger"></i>
                                <span>At least one lowercase letter</span>
                            </div>
                            <div class="requirement" id="req-uppercase">
                                <i class="bi bi-x-circle text-danger"></i>
                                <span>At least one uppercase letter</span>
                            </div>
                            <div class="requirement" id="req-number">
                                <i class="bi bi-x-circle text-danger"></i>
                                <span>At least one number</span>
                            </div>
                            <div class="requirement" id="req-special">
                                <i class="bi bi-x-circle text-danger"></i>
                                <span>At least one special character</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="savePasswordBtn" disabled>
                    <i class="bi bi-shield-check me-1"></i>Change Password
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Password visibility toggles
    function setupPasswordToggle(inputId, toggleId) {
        const input = document.getElementById(inputId);
        const toggle = document.getElementById(toggleId);
        
        toggle.addEventListener('click', function() {
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);
            
            const icon = this.querySelector('i');
            icon.className = type === 'password' ? 'bi bi-eye' : 'bi bi-eye-slash';
        });
    }
    
    setupPasswordToggle('currentPassword', 'toggleCurrentPassword');
    setupPasswordToggle('newPassword', 'toggleNewPassword');
    setupPasswordToggle('confirmPassword', 'toggleConfirmPassword');
    
    // Password strength checker
    const newPasswordInput = document.getElementById('newPassword');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const strengthIndicator = document.getElementById('passwordStrength');
    const strengthBar = document.getElementById('strengthBar');
    const strengthText = document.getElementById('strengthText');
    const saveBtn = document.getElementById('savePasswordBtn');
    
    newPasswordInput.addEventListener('input', function() {
        const password = this.value;
        
        if (password.length > 0) {
            strengthIndicator.style.display = 'block';
            checkPasswordStrength(password);
            checkPasswordRequirements(password);
        } else {
            strengthIndicator.style.display = 'none';
        }
        
        validateForm();
    });
    
    confirmPasswordInput.addEventListener('input', validateForm);
    
    function checkPasswordStrength(password) {
        let strength = 0;
        let strengthText = '';
        let strengthClass = '';
        
        if (password.length >= 8) strength++;
        if (/[a-z]/.test(password)) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;
        
        switch (strength) {
            case 0:
            case 1:
                strengthText = 'Very Weak';
                strengthClass = 'bg-danger';
                break;
            case 2:
                strengthText = 'Weak';
                strengthClass = 'bg-warning';
                break;
            case 3:
                strengthText = 'Fair';
                strengthClass = 'bg-info';
                break;
            case 4:
                strengthText = 'Good';
                strengthClass = 'bg-primary';
                break;
            case 5:
                strengthText = 'Strong';
                strengthClass = 'bg-success';
                break;
        }
        
        strengthBar.className = `progress-bar ${strengthClass}`;
        strengthBar.style.width = `${(strength / 5) * 100}%`;
        document.getElementById('strengthText').textContent = strengthText;
    }
    
    function checkPasswordRequirements(password) {
        const requirements = {
            'req-length': password.length >= 8,
            'req-lowercase': /[a-z]/.test(password),
            'req-uppercase': /[A-Z]/.test(password),
            'req-number': /[0-9]/.test(password),
            'req-special': /[^A-Za-z0-9]/.test(password)
        };
        
        Object.keys(requirements).forEach(reqId => {
            const element = document.getElementById(reqId);
            const icon = element.querySelector('i');
            
            if (requirements[reqId]) {
                icon.className = 'bi bi-check-circle text-success';
                element.classList.add('text-success');
            } else {
                icon.className = 'bi bi-x-circle text-danger';
                element.classList.remove('text-success');
            }
        });
    }
    
    function validateForm() {
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        
        const isValidPassword = newPassword.length >= 8 &&
                               /[a-z]/.test(newPassword) &&
                               /[A-Z]/.test(newPassword) &&
                               /[0-9]/.test(newPassword) &&
                               /[^A-Za-z0-9]/.test(newPassword);
        
        const passwordsMatch = newPassword === confirmPassword;
        const hasCurrentPassword = currentPassword.length > 0;
        
        saveBtn.disabled = !(isValidPassword && passwordsMatch && hasCurrentPassword);
        
        // Show password match indicator
        if (confirmPassword.length > 0) {
            const confirmInput = confirmPasswordInput;
            if (passwordsMatch) {
                confirmInput.classList.remove('is-invalid');
                confirmInput.classList.add('is-valid');
            } else {
                confirmInput.classList.remove('is-valid');
                confirmInput.classList.add('is-invalid');
            }
        }
    }
    
    // Save password
    saveBtn.addEventListener('click', function() {
        this.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Changing...';
        this.disabled = true;
        
        setTimeout(() => {
            this.innerHTML = '<i class="bi bi-shield-check me-1"></i>Change Password';
            this.disabled = false;
            
            const alert = document.createElement('div');
            alert.className = 'alert alert-success';
            alert.innerHTML = '<i class="bi bi-check-circle me-2"></i>Password changed successfully!';
            document.querySelector('.modal-body').prepend(alert);
            
            setTimeout(() => {
                const modal = bootstrap.Modal.getInstance(document.getElementById('changePasswordModal'));
                modal.hide();
            }, 1500);
        }, 2000);
    });
});
</script>

<style>
.requirements-list {
    font-size: 0.85rem;
}

.requirement {
    display: flex;
    align-items: center;
    margin-bottom: 0.25rem;
}

.requirement i {
    margin-right: 0.5rem;
    width: 16px;
}
</style>
