<!-- Adjust Stock Modal -->
<div class="modal fade" id="adjustStockModal" tabindex="-1" aria-labelledby="adjustStockModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="adjustStockModalLabel">Adjust Stock - Organic Rice 5kg</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="adjustStockForm">
                    <!-- Current Stock Info -->
                    <div class="current-stock-info mb-4 p-3 bg-light rounded">
                        <div class="d-flex align-items-center">
                            <img src="../../../assets/images/rice.jpg" alt="Product" class="product-thumbnail me-3" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;">
                            <div>
                                <h6 class="mb-1">Organic Rice 5kg</h6>
                                <p class="mb-1 text-muted">SKU: SKU-001</p>
                                <p class="mb-0"><strong>Current Stock: <span class="text-success">85 units</span></strong></p>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Adjustment Type</label>
                        <select class="form-select" id="adjustmentType" required>
                            <option value="">Select adjustment type...</option>
                            <option value="add">Add Stock (+)</option>
                            <option value="remove">Remove Stock (-)</option>
                            <option value="set">Set Exact Amount</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Quantity</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="adjustmentQuantity" placeholder="Enter quantity" min="1" required>
                            <span class="input-group-text">units</span>
                        </div>
                        <div class="form-text" id="newStockPreview"></div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Reason for Adjustment</label>
                        <select class="form-select" id="adjustmentReason" required>
                            <option value="">Select reason...</option>
                            <option value="received-inventory">Received new inventory</option>
                            <option value="damaged-items">Damaged items</option>
                            <option value="expired-items">Expired items</option>
                            <option value="theft-loss">Theft/Loss</option>
                            <option value="counting-error">Counting error correction</option>
                            <option value="customer-return">Customer return</option>
                            <option value="quality-control">Quality control rejection</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Additional Notes</label>
                        <textarea class="form-control" id="adjustmentNotes" rows="3" placeholder="Optional: Add any additional details about this adjustment..."></textarea>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="updatePrice">
                        <label class="form-check-label" for="updatePrice">
                            Also update product price (if receiving new inventory with different cost)
                        </label>
                    </div>

                    <div id="priceUpdateSection" class="mt-3" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">New Unit Price</label>
                            <div class="input-group">
                                <span class="input-group-text">â‚±</span>
                                <input type="number" class="form-control" id="newUnitPrice" placeholder="350.00" step="0.01">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="adjustStockForm" class="btn-seller">
                    <i class="bi bi-check-circle"></i> Apply Adjustment
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const adjustmentType = document.getElementById('adjustmentType');
    const adjustmentQuantity = document.getElementById('adjustmentQuantity');
    const newStockPreview = document.getElementById('newStockPreview');
    const updatePriceCheckbox = document.getElementById('updatePrice');
    const priceUpdateSection = document.getElementById('priceUpdateSection');
    
    const currentStock = 85; // This would come from the selected product
    
    // Update stock preview
    function updatePreview() {
        const type = adjustmentType.value;
        const quantity = parseInt(adjustmentQuantity.value) || 0;
        
        if (type && quantity > 0) {
            let newStock;
            switch(type) {
                case 'add':
                    newStock = currentStock + quantity;
                    break;
                case 'remove':
                    newStock = currentStock - quantity;
                    break;
                case 'set':
                    newStock = quantity;
                    break;
            }
            
            const color = newStock >= 0 ? 'text-success' : 'text-danger';
            newStockPreview.innerHTML = `New stock will be: <span class="${color}">${newStock} units</span>`;
            
            if (newStock < 0) {
                newStockPreview.innerHTML += ' <span class="text-danger">(Warning: Negative stock)</span>';
            }
        } else {
            newStockPreview.innerHTML = '';
        }
    }
    
    adjustmentType.addEventListener('change', updatePreview);
    adjustmentQuantity.addEventListener('input', updatePreview);
    
    // Toggle price update section
    updatePriceCheckbox.addEventListener('change', function() {
        priceUpdateSection.style.display = this.checked ? 'block' : 'none';
    });
    
    // Handle form submission
    document.getElementById('adjustStockForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const type = adjustmentType.value;
        const quantity = parseInt(adjustmentQuantity.value);
        const reason = document.getElementById('adjustmentReason').value;
        const notes = document.getElementById('adjustmentNotes').value;
        const updatePrice = updatePriceCheckbox.checked;
        const newPrice = document.getElementById('newUnitPrice').value;
        
        if (!type || !quantity || !reason) {
            alert('Please fill in all required fields.');
            return;
        }
        
        // Calculate new stock
        let newStock;
        switch(type) {
            case 'add':
                newStock = currentStock + quantity;
                break;
            case 'remove':
                newStock = currentStock - quantity;
                break;
            case 'set':
                newStock = quantity;
                break;
        }
        
        if (newStock < 0 && !confirm('This will result in negative stock. Are you sure you want to continue?')) {
            return;
        }
        
        // Here you would send the data to your backend
        console.log('Stock adjustment:', {
            type,
            quantity,
            reason,
            notes,
            newStock,
            updatePrice,
            newPrice
        });
        
        alert('Stock adjusted successfully!');
        
        // Close modal and refresh
        bootstrap.Modal.getInstance(document.getElementById('adjustStockModal')).hide();
    });
});
</script>
